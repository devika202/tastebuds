<div class="container">
  <h1 class="text-center mt-4">Accounting Records</h1><br>
  <div class="row">

    <div class="col-md-6 offset-md-3">
      <form class="form-inline" action="/admin/accounting" method="GET">
        <div class="form-group">
          <label for="from_date">From:</label>
          <input type="date" class="form-control" id="from_date" name="from_date">
        </div>
        <div class="form-group ml-2">
          <label for="to_date">To:</label>
          <input type="date" class="form-control" id="to_date" name="to_date">
        </div><br>
        <button type="submit" class="btn btn-primary ml-2">Search</button>
      </form>
    </div>
  </div><br>

  <table class="table table-striped table-bordered table-hover">
    <thead>
      <tr>
        <th scope="col">Mode of sales</th>
        <th scope="col">Order ID</th>
        <th scope="col">Sales Report ID</th>
        <th scope="col">Amount</th>
        <th scope="col">Date</th>
        <th scope="col">Action</th>
      </tr>
    </thead>
    <tbody class="table-group-divider">
      <% total_amount = 0 %>
      <% @accounting_records.each do |accounting_record| %>
        <tr>
          <td scope="row"><%= accounting_record.source %></td>
          <td scope="row"><%= accounting_record.order&.id.presence || 'N/A' %></td>
          <td scope="row"><%= accounting_record.sales_report&.id.presence || 'N/A' %></td>
          <td scope="row">
            <% if accounting_record.sales_report_id.present? %>
              <% sales_report = SalesReport.find_by(id: accounting_record.sales_report_id) %>
              <% amount = sales_report&.total_price || 0 %>
            <% elsif accounting_record.order_id.present? %>
              <% order = Order.find_by(id: accounting_record.order_id) %>
              <% amount = order&.total_price || 0 %>
            <% else %>
              <% amount = 0 %>
            <% end %>
            <%= amount %>
            <% total_amount += amount %>
          </td>
          <td scope="row"><%= accounting_record.created_at.strftime("%d-%m-%y") %></td>
          <td scope="row">
            <%= link_to 'Edit', edit_admin_accounting_path(accounting_record), class: "btn btn-primary " %>
            <%= link_to 'Destroy', admin_accounting_path(accounting_record), method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-primary " %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <br>
  <div class="text-center">
    <h4>Total Sales Amount: <%= total_amount %></h4>
    <h4>Sales Count: <%= @accounting_records.count %></h4>
  </div>
</div>
<br>